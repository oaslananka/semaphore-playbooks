---
- name: Sistem ZamanÄ± ve AÄŸ KontrolÃ¼
  hosts: all
  become: true
  gather_facts: no

  tasks:

    - name: ğŸ•’ Sistem zamanÄ± kontrol
      command: timedatectl
      register: time_output

    - name: ğŸ–¨ Zaman Ã§Ä±ktÄ±sÄ±nÄ± yazdÄ±r
      debug:
        var: time_output.stdout_lines

    - name: ğŸ”„ NTP senkronizasyon durumu
      shell: timedatectl show -p NTPSynchronized --value
      register: ntp_sync

    - name: ğŸ“¢ NTP senkronizasyon sonucu
      debug:
        msg: "NTP senkronizasyonu: {{ ntp_sync.stdout }}"

    - name: ğŸŒ Google DNS'e ping at (internet baÄŸlantÄ± kontrolÃ¼)
      command: ping -c 3 8.8.8.8
      register: ping_result
      ignore_errors: true

    - name: ğŸ“¡ Ping sonucu
      debug:
        var: ping_result.stdout_lines

    - name: ğŸ› ï¸ RTC yerel saat olarak ayarlÄ± mÄ±? (uyarÄ± varsa dÃ¼zelt)
      shell: timedatectl set-local-rtc 0 --adjust-system-clock
      when: "'RTC in local TZ: yes' in time_output.stdout"
      register: rtc_fix
      retries: 3
      delay: 5
      until: rtc_fix.rc == 0
      ignore_errors: true

    - name: â— RTC dÃ¼zeltme sonucu (hata varsa)
      debug:
        msg: "â€¼ï¸ RTC dÃ¼zeltme baÅŸarÄ±sÄ±z: {{ rtc_fix.stderr }}"
      when: rtc_fix is failed
